#!/usr/bin/env bash
# FETCH AFH PASSWORD #
pas=$(cat /media/shagbag913/Roms/.pas)
# BUILD DIRECTORIES
# AEX
bdir1=/media/shagbag913/Roms/roms/aex
# DU
bdir2=/media/shagbag913/Roms/roms/du
# DOT
bdir3=/media/shagbag913/Roms/roms/dot
# AICP
bdir4=/media/shagbag913/Roms/roms/aicp
### FUNCTIONS ###
autopilot() {
## AEX ##
   cd $bdir1
   sync
   lunchh
   lunch aosp_sailfish-userdebug
   echo "**Building AospExtended**" | python3 ~/localscripts/dis.py
   make aex -j6
      if [ "$?" = "0" ]; then
         echo "*AospExtended Built Successfully!*" | python3 ~/localscripts/dis.py
      else
         echo "*AospExtended Failed...*" | python3 ~/localscripts/dis.py
      fi
   curl -T /media/shagbag913/Roms/roms/aex/out/target/product/sailfish/AospExtended-v5*.zip ftp://shagbag913:$pas@uploads.androidfilehost.com
## DU ##
   cd $bdir2
   sync
   echo "**Building Dirty Unicorns**" | python3 ~/localscripts/dis.py
   brunchh
      if [ "$?" = "0" ]; then
         echo "*Dirty Unicorns Built Successfully!*" | python3 ~/localscripts/dis.py
      else
         echo "*Dirty Unicorns Build Failed...*" | python3 ~/localscripts/dis.py
      fi
   curl -T /media/shagbag913/Roms/roms/du/out/target/product/sailfish/du_sailfish-v*.zip ftp://shagbag913:$pas@uploads.androidfilehost.com
## DOT ##
   cd $bdir3
   sync
   echo Copying theming patch
   rm -rf /media/shagbag913/Roms/roms/dot/build/core/build_rro_package.mk
   cp /media/shagbag913/Roms/patches/build_rro_package.mk /media/shagbag913/Roms/roms/dot/build/core/build_rro_package.mk
   echo "**Building dotOS**" | python3 ~/localscripts/dis.py
   brunchh
      if [ "$?" = "0" ]; then
         echo "*dotOS Built Successfully!*" | python3 ~/localscripts/dis.py
      else
         echo "*dotOS Build Failed...*" | python3 ~/localscripts/dis.py
      fi
   curl -T /media/shagbag913/Roms/roms/dot/out/target/product/sailfish/dotOS-O-*.zip ftp://shagbag913:$pas@uploads.androidfilehost.com
## AICP ##
   cd $bdir4
   sync
   echo "**Building AICP**" | python3 ~/localscripts/dis.py
   brunchh
      if [ "$?" = "0" ]; then
         echo "*AICP Built Successfully!*" | python3 ~/localscripts/dis.py
      else
         echo "*AICP Build Failed...*" | python3 ~/localscripts/dis.py
      fi
   curl -T /media/shagbag913/Roms/roms/aicp/out/target/product/sailfish/aicp_sailfish_o-13.1*.zip ftp://shagbag913:$pas@uploads.androidfilehost.com
}
sync() {
   echo Syncing up $1...
   time (repo sync -j6 --no-tags --no-clone-bundle --force-sync -f -q)
   if [ "$?" = "0" ]; then
      echo Successfully synced!
   else
      echo Sync failed.
   fi
}
clean() {
   echo Cleaning outputs...
   cd $bdir1
   make clobber
   cd $bdir2
   make clobber
   cd $bdir3
   make clobber
   echo Outputs cleaned.
   echo "**Outputs cleaned**" | python3 ~/localscripts/dis.py

}
dust() {
   echo Doing partial clean
   cd $bdir1
   rm -rf out/target/product/sailfish/AospExtended*.zip
   echo AEX Dusted
   cd $bdir2
   rm -rf out/target/product/sailfish/du_sailfish-v*.zip
   echo DU Dusted
   cd $bdir3
   rm -rf out/target/product/sailfish/dotOS-O-v*.zip
   echo dotOS Dusted
   cd $bdir4
   rm -rf out/target/product/sailfish/aicp_sailfish*.zip
   echo AICP Dusted
}
brunchh() {
   time (echo Setting up build enviroment...
   . build/envsetup.sh
   echo Building...
   brunch sailfish -j6)
   if [ "$?" = "0" ]; then
     echo Build Successful!
   else
      echo Error: build not successful.
   fi
}
lunchh() {
   echo Setting up build enviroment...
   . build/envsetup.sh
   echo Building...
}
while [ "$1" != "" ]; do
   case $1 in
      --brunch ) brunchh;;
      -s | --sync ) sync;;
      -c | --clean ) clean;;
      -a | --autopilot ) autopilot;;
      -u | --upload ) curl -T $2 ftp://shagbag913:$pas@uploads.androidfilehost.com;;
      -d | --dust ) dust;;
   esac
shift
done
