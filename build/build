#!/usr/bin/env bash
# FETCH AFH PASSWORD #
pas=$(cat /media/shagbag913/Roms/.pas)
# BUILD DIRECTORIES
# AEX
bdir1=/media/shagbag913/Roms/roms/aex
# DU
bdir2=/media/shagbag913/Roms/roms/du
# DOT
bdir3=/media/shagbag913/Roms/roms/dot
### FUNCTIONS ###
autopilot() {
## AEX ##
   cd $bdir1
   clean
   sync
   lunchh
   lunch aosp_sailfish-userdebug
   echo "**Starting AEX Build**" | python3 ~/localscripts/dis.py
   make aex -j6
      if [ "$?" = "0" ]; then
         echo "**AEX Built Successfully!**" | python3 ~/localscripts/dis.py
      else
         echo "*AEX Build Failed...*" | python3 ~/localscripts/dis.py
      fi
   curl -T /media/shagbag913/Roms/roms/aex/out/target/product/sailfish/AospExtended-v5*.zip ftp://shagbag913:$pas@uploads.androidfilehost.com
## DU ##
   cd $bdir2
   clean
   sync
   echo "**Starting Dirty Unicorns Build**" | python3 ~/localscripts/dis.py
   brunchh
      if [ "$?" = "0" ]; then
         echo "**Dirty Unicorns Built Successfully!**" | python3 ~/localscripts/dis.py
      else
         echo "*Dirty Unicorns Build Failed...*" | python3 ~/localscripts/dis.py
      fi
   curl -T /media/shagbag913/Roms/roms/du/out/target/product/sailfish/du_sailfish-v*.zip ftp://shagbag913:$pas@uploads.androidfilehost.com
## DOT ##
   cd $bdir3
   clean
   sync
   echo Copying theming patch
   rm -rf /media/shagbag913/Roms/roms/dot/build/core/build_rro_package.mk
   cp /media/shagbag913/Roms/patches/build_rro_package.mk /media/shagbag913/Roms/roms/dot/build/core/build_rro_package.mk
   echo "**Starting dotOS Build**" | python3 ~/localscripts/dis.py
   brunchh
      if [ "$?" = "0" ]; then
         echo "**dotOS Built Successfully!**" | python3 ~/localscripts/dis.py
      else
         echo "*dotOS Build Failed...*" | python3 ~/localscripts/dis.py
      fi
   curl -T /media/shagbag913/Roms/roms/dot/out/target/product/sailfish/dotOS-O-v*.zip ftp://shagbag913:$pas@uploads.androidfilehost.com
}
sync() {
   echo Syncing up $1...
   time (repo sync -j6 --no-tags --no-clone-bundle --force-sync -f -q)
   if [ "$?" = "0" ]; then
      echo Successfully synced!
   else
      echo Sync failed.
   fi
}
clean() {
   echo Cleaning outputs...
   make clobber
   if [ "$?" = "0" ]; then
      echo Outputs cleaned successfully!
   else
      echo Outputs not cleaned.
   fi
}
brunchh() {
   time (echo Setting up build enviroment...
   . build/envsetup.sh
   echo Building...
   brunch sailfish -j6)
   if [ "$?" = "0" ]; then
     echo Build Successful!
   else
      echo Error: build not successful.
   fi
}
lunchh() {
   echo Setting up build enviroment...
   . build/envsetup.sh
   echo Building...
}
while [ "$1" != "" ]; do
   case $1 in
      --brunch ) brunchh;;
      -s | --sync ) sync;;
      -c | --clean ) clean;;
      -a | --autopilot ) autopilot;;
      * ) echo "Unknown command. Type 'build --help' for more info.";;
   esac
shift
done
