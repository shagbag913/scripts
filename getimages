#!/bin/bash
set -e

# Source common stuff
source common

# Upload to gdrive? Leave blank If you don't want to.
GD_IMAGES="${GD_FOLDER}/Images"
GD_IMAGESURL=http://gg.gg/shagbag913_images

# dir is where you want the factory image to be downloaded too.
DIR=/media/shagbag913/Roms/factimages

# savedir is where you want the vendor, bootloader, and radio images to be saved too.
# if you name it 'images-${folder}', it will be named 'images-<build-id>'.
SAVEDIR=${DIR}/images-$(date +%b-%Y)

URL=$1
ZIP=$(basename ${URL})
FOLDER=$(echo ${ZIP} | awk -F-factory '{print $1}')
IMAGE=image-${FOLDER}.zip
mkdir -p ${SAVEDIR}
mkdir -p ${DIR}
cd ${DIR}
wget ${URL}
unzip ${ZIP}
cd ${FOLDER}
unzip ${IMAGE}
cp vendor.img ${SAVEDIR}/${DEVICE}-vendor-$(date +%b-%Y).img
cp radio-${DEVICE}*.img ${SAVEDIR}/${DEVICE}-radio-$(date +%b-%Y).img
cp bootloader-${DEVICE}*.img ${SAVEDIR}/${DEVICE}-bootloader-$(date +%b-%Y).img
cp boot.img ${SAVEDIR}/${DEVICE}-boot-$(date +%b-%Y).img
rm -rf ${DIR}/${ZIP}

# Upload to gdrive
if [[ ${GD_FOLDER} != "" ]]; then
    rm -rf ${GD_IMAGES}/*
    mkdir -p ${GD_IMAGES}
    cp vendor.img ${GD_IMAGES}/${DEVICE}-vendor-$(date +%b-%Y).img
    cp radio-${DEVICE}*.img ${GD_IMAGES}/${DEVICE}-radio-$(date +%b-%Y).img
    cp bootloader-${DEVICE}*.img ${GD_IMAGES}/${DEVICE}-bootloader-$(date +%b-%Y).img
    cp boot.img ${GD_IMAGES}/${DEVICE}-boot-$(date +%b-%Y).img
    cd ${GD_FOLDER}
    grive
        dc_msg "**Google Drive: $(date +%B)'s vendor, radio, bootloader, and boot images have been uploaded! ${GD_IMAGESURL}**"
    fi
