#!/bin/bash
# Upload to gdrive? Leave blank If you don't want to.
gdrivetop=/media/shagbag913/Roms/gdrive
gdrivesavedir=/media/shagbag913/Roms/gdrive/Images
gdrivelink=http://gg.gg/shagbag913_images

# Notify discord? Leave blank if no.
disscript=~/localscripts/dis.py
set -e
# dir is where you want the factory image to be downloaded too.
dir=/media/shagbag913/Roms/factimages

# savedir is where you want the vendor, bootloader, and radio images to be saved too.
# if you name it 'images-${folder}', it will be named 'images-<build-id>'.
savedir=/media/shagbag913/Roms/factimages/images-$(date +%b-%Y)

# Your device codename.
device=sailfish

url=$1
ZIP=$(basename ${url})
folder=$(echo ${ZIP} | awk -F-factory '{print $1}')
image=image-${folder}.zip
mkdir -p $savedir
mkdir -p $dir
cd $dir
wget $url
unzip $ZIP
cd $folder
unzip $image
cp vendor.img $savedir/${device}-vendor-$(date +%b-%Y).img
cp radio-${device}*.img $savedir/${device}-radio-$(date +%b-%Y).img
cp bootloader-${device}*.img $savedir/${device}-bootloader-$(date +%b-%Y).img
cp boot.img $savedir/${device}-boot-$(date +%b-%Y).img
rm -rf $dir/$ZIP

# Upload to gdrive
if [[ $gdrivetop != "" ]]; then
    rm -rf ${gdrivesavedir}/*
    cp vendor.img $gdrivesavedir/${device}-vendor-$(date +%b-%Y).img
    cp radio-${device}*.img $gdrivesavedir/${device}-radio-$(date +%b-%Y).img
    cp bootloader-${device}*.img $gdrivesavedir/${device}-bootloader-$(date +%b-%Y).img
    cp boot.img $gdrivesavedir/${device}-boot-$(date +%b-%Y).img
    cd $gdrivetop
    grive
    if [[ $disscript != "" ]]; then
        echo "**Google Drive: $(date +%B)'s vendor, radio, bootloader, and boot images have been uploaded!**" ${gdrivelink} | python3 $disscript
    fi
fi
